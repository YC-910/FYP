  <!DOCTYPE html>
  <html lang="en">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Healthcare Facility Recommendation</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

  <style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    height: 100vh;
    display: flex;
    overflow: hidden;
  }

  /* ‚úÖ LEFT SIDEBAR NAVBAR */
  .navbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 250px;
    height: 100%;
    background: #1976d2;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 1.5rem 1rem;
    box-shadow: 3px 0 10px rgba(0,0,0,0.2);
    transition: transform 0.3s ease;
    z-index: 10;
  }

  .navbar .logo {
    font-weight: 700;
    font-size: 1.8rem;
    margin-bottom: 2rem;
    text-align: left;
    width: 100%;
    padding-left: 10px;
  }

  .nav-links {
    display: flex;
    flex-direction: column;
    gap: 1.4rem;
    width: 100%;
  }

  .nav-links a {
    color: white;
    text-decoration: none;
    font-weight: 600;
    padding: 1rem 1.2rem;
    border-radius: 8px;
    font-size: 1.1rem;
    transition: background 0.3s;
  }

  .nav-links a:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  /* Hamburger for phone */
  .hamburger {
    display: none;
    flex-direction: column;
    cursor: pointer;
    position: absolute;
    top: 1rem;
    right: 1rem;
  }

  .hamburger span {
    background: white;
    height: 3px;
    width: 25px;
    margin: 4px 0;
    border-radius: 5px;
  }

  /* ‚úÖ MAIN CONTENT (to right of sidebar) */
  .main-content {
    flex: 1;
    margin-left: 250px;
    padding: 2.5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.25rem;
  }

  /* Flipbook container */
  .book-container {
    perspective: 1800px;
    width: 95%;
    max-width: 1200px;
    height: 85vh;
    position: relative;
  }

  .book {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.8s ease;
  }

  .book.flipped {
    transform: rotateY(-180deg);
  }

  .page {
    position: absolute;
    width: 100%;
    height: 100%;
    background: white;
    padding: 3rem 4rem;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 64, 128, 0.2);
    backface-visibility: hidden;
    box-sizing: border-box;
    font-size: 1.25rem;
  }

  .front { z-index: 2; }
  .back { transform: rotateY(180deg); }

  h1 {
    font-size: 2.4rem;
    text-align: center;
    color: #0d47a1;
    margin-bottom: 2rem;
    border-bottom: 3px solid #90caf9;
    padding-bottom: 0.6rem;
  }

  /* Form styling */
  .form-group {
    margin-bottom: 1.8rem;
  }

  label {
    font-size: 1.3rem;
    font-weight: 600;
    display: block;
    margin-bottom: 0.6rem;
    color: #0d47a1;
  }

  select {
    font-size: 1.2rem;
    padding: 1rem;
    width: 100%;
    border: 2px solid #90caf9;
    border-radius: 8px;
    background: #f8fbff;
  }

  button {
    width: 100%;
    padding: 1.1rem;
    font-size: 1.3rem;
    font-weight: bold;
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover {
    background: #1565c0;
    transform: scale(1.03);
  }

  /* Table styling */
  #results {
    margin-top: 1.5rem;
    max-height: 65vh;
    overflow-y: auto;
    font-size: 1.2rem;
    margin-bottom: 20px;
  }

  #resultsTable {
    width: 100%;
    border-collapse: collapse;
    background: #fafafa;
    font-size: 1.15rem;
  }

  #resultsTable th {
    background: #1976d2;
    color: white;
    padding: 14px;
    text-align: left;
    position: sticky;
    top: 0;
  }

  #resultsTable td {
    padding: 14px;
    border-bottom: 1px solid #ddd;
  }

  #resultsTable tr:hover {
    background: #e3f2fd;
  }

  a {
    color: #1976d2;
    font-weight: 600;
    text-decoration: none;
    font-size: 1.15rem;
  }

  a:hover {
    text-decoration: underline;
  }

  /* ‚úÖ Responsive design */
  @media (max-width: 900px) {
    .navbar {
      width: 220px;
      transform: translateX(-100%);
      position: fixed;
    }

    .navbar.active {
      transform: translateX(0);
    }

    .hamburger {
      display: flex;
    }

    .main-content {
      margin-left: 0;
      width: 100%;
      padding: 1.5rem;
      font-size: 1.1rem;
    }

    .page {
      padding: 1.5rem;
      font-size: 1.1rem;
    }

    h1 {
      font-size: 1.8rem;
    }
  }

  /* Collapsible panels */
  .collapsible {
    background-color: #1976d2;
    color: white;
    cursor: pointer;
    padding: 15px 20px;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
    font-size: 1.3rem;
    font-weight: 600;
    border-radius: 8px;
    transition: background 0.3s;
    margin-top: 15px;
  }

  .collapsible:hover {
    background-color: #1565c0;
  }

  .collapsible::after {
    content: '‚ûï';
    font-size: 1.3rem;
    float: right;
  }

  .collapsible.active::after {
    content: '‚ûñ';
  }

  .content-panel {
    padding: 0 20px;
    max-height: 0;
    overflow: hidden;
    background-color: #f8fbff;
    border: 1px solid #90caf9;
    border-radius: 8px;
    transition: max-height 0.3s ease-out;
    margin-bottom: 15px;
  }

  </style>
  </head>

  <body>
  <nav class="navbar" id="navbar">
    <div class="logo">üè• Healthcare</div>
    <div class="nav-links">
      <a href="/index">üè† Home</a>
      <a href="/Hospital">üè¢ Add Hospital</a>
      <a href="/Department">üè¢ Add State Department</a>
      <a href="/Labotary">üè¢ Add Public Healthcare Labotary</a>
      <a href="/Welcome">üîê LogOut</a>
    </div>
  </nav>

  <!-- Hamburger only visible on mobile -->
  <div class="hamburger" onclick="toggleMenu()">
    <span></span><span></span><span></span>
  </div>

  <!-- ‚úÖ Main Content -->
  <div class="main-content">
    <div class="book-container">
      <div class="book" id="book">

        <!-- Page 1 -->
        <div class="page front">
          <h1>üìñ Healthcare Facility Recommendation</h1>
          <form id="searchForm">
            <div class="form-group">
              <label for="disease">Symptom</label>
              <select id="disease">
                <option disabled selected>Loading symptom...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="state">State</label>
              <select id="state">
                <option disabled selected>Loading states...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="city">City</label>
              <select id="city" disabled></select>
            </div>
            <button type="submit">üîç Provide Output</button>
          </form>
        </div>

        <!-- Page 2 -->
        <div class="page back">
          <h1>üìã Search Results</h1>

          <!-- Collapsible Results -->
          <div id="results" class="results-container">No results yet.</div>

          <button onclick="flipBack()" class="back-button">‚¨Ö Back</button>
        </div>


      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script>
let diseaseChoices, stateChoices, cityChoices;

function toggleMenu() {
  document.getElementById('navbar').classList.toggle('active');
}

// Load diseases
async function loadDiseases() {
  const res = await fetch('/api/symptoms');
  const data = await res.json();
  const dropdown = document.getElementById('disease');
  dropdown.innerHTML = '<option disabled selected> </option>';
  data.forEach(item => {
    const opt = document.createElement('option');
    opt.value = item.diseases;
    opt.textContent = item.diseases;
    dropdown.appendChild(opt);
  });
  if (diseaseChoices) diseaseChoices.destroy();
  diseaseChoices = new Choices(dropdown, { searchEnabled: true, shouldSort: false });
  dropdown.addEventListener('change', () => document.getElementById('state').disabled = false);
}

// Load states
async function loadStates() {
  const res = await fetch('/api/states');
  const states = await res.json();
  const dropdown = document.getElementById('state');
  dropdown.innerHTML = '<option disabled selected>Select a state</option>';
  states.forEach(state => {
    const opt = document.createElement('option');
    opt.value = state;
    opt.textContent = state;
    dropdown.appendChild(opt);
  });
  if (stateChoices) stateChoices.destroy();
  stateChoices = new Choices(dropdown, { searchEnabled: true, shouldSort: false });
  dropdown.disabled = true;
  dropdown.addEventListener('change', () => loadCities(dropdown.value));
}

// Load cities
async function loadCities(state) {
  const res = await fetch(`/api/cities/${encodeURIComponent(state)}`);
  const cities = await res.json();
  const dropdown = document.getElementById('city');
  dropdown.innerHTML = '<option disabled selected>Select a city</option>';
  dropdown.disabled = false;
  if (cityChoices) cityChoices.destroy();
  cities.forEach(city => {
    const opt = document.createElement('option');
    opt.value = city;
    opt.textContent = city;
    dropdown.appendChild(opt);
  });
  cityChoices = new Choices(dropdown, { searchEnabled: true, shouldSort: false });
}

// Search hospitals
document.getElementById('searchForm').addEventListener('submit', async e => {
  e.preventDefault();
  const state = document.getElementById('state').value;
  const city = document.getElementById('city').value;
  const disease = document.getElementById('disease').value;

  let hospitalContent = '';

  try {
    const res = await fetch(`/api/search?state=${encodeURIComponent(state)}&city=${encodeURIComponent(city)}`);
    const data = await res.json();

    if (data && data.length > 0) {
      hospitalContent = renderHospitalTableHTML(data);
    } else {
      hospitalContent = `<p>‚ùå No hospitals found for <b>${city}, ${state}</b>.</p>`;
    }
  } catch (err) {
    console.error("Error fetching hospital data:", err);
    hospitalContent = `<p>‚ö†Ô∏è Error retrieving hospital information.</p>`;
  }

  // Pass the disease name as first argument
  flipToResults(disease, hospitalContent);
});

// Generate hospital table HTML
function renderHospitalTableHTML(hospitals) {
  let tableHTML = `<table id="resultsTable">
    <thead>
      <tr>
        <th>Name</th><th>State</th><th>City</th>
        <th>Address</th><th>Phone</th><th>Location</th>
      </tr>
    </thead>
    <tbody>`;
  hospitals.forEach(h => {
    tableHTML += `<tr>
      <td>${h.Name}</td>
      <td>${h.State}</td>
      <td>${h.City}</td>
      <td>${h.Address}</td>
      <td>${h.Phone_No}</td>
      <td><a href="${h.Location}" target="_blank">View Map</a></td>
    </tr>`;
  });
  tableHTML += `</tbody></table>`;
  return tableHTML;
}

// Flipbook functions
function flipToResults(disease, hospitalContent) {
  const resultsHTML = `
    <p style="font-size:1.2rem; font-weight:600; color:#0d47a1; margin-bottom:10px;">
      Here are the hospitals that provide check-ups for <b>${disease}</b>::
    </p>

    <button class="collapsible">üè• Hospital List</button>
    <div class="content-panel">${hospitalContent}</div>
  `;

  document.getElementById('results').innerHTML = resultsHTML;
  document.getElementById('book').classList.add('flipped');

  const collapsibles = document.getElementsByClassName("collapsible");
  for (let i = 0; i < collapsibles.length; i++) {
    collapsibles[i].addEventListener("click", function() {
      this.classList.toggle("active");
      const panel = this.nextElementSibling;
      panel.style.maxHeight = panel.style.maxHeight ? null : panel.scrollHeight + "px";
    });
  }
}

function flipBack() {
  document.getElementById('book').classList.remove('flipped');
}

// Load dropdowns
loadDiseases();
loadStates();
</script>
</body>
</html>